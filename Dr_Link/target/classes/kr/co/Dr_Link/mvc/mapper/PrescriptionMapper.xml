<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="prescription">
  
   <!-- 김다유 : 처방전 의사정보 resultMap -->
   	<resultMap type="departmentDTO" id="departmentDTO">
		<result column="dep_num" property="dep_num"/>
		<result column="dep_name" property="dep_name"/>
	</resultMap>
	
	<resultMap type="doctorDTO" id="doctorMap">
		<result column="dep_num" property="dep_num" />
		<result column="d_id" property="d_id" />
		<result column="d_pwd" property="d_pwd" />
		<result column="d_name" property="d_name" />
		<result column="d_jumin_num" property="d_jumin_num" />
		<result column="d_phone_num" property="d_phone_num" />
		<result column="d_address" property="d_address" />
		<result column="d_email" property="d_email" />
		<result column="d_career" property="d_career" />
		<result column="d_licence" property="d_licence" />
		<result column="d_photo" property="d_photo" />
		<result column="d_regdate" property="d_regdate" />
		<result column="d_graduation" property="d_graduation" />
		<result column="d_school" property="d_school" />
		<result column="d_whengrad" property="d_whengrad" />
		<collection property="departmentDTO" resultMap="departmentDTO"/>
	</resultMap>

   
   <!-- 김다유 : 처방전 환자 정보 -->
  <select id="patient_info" parameterType="patientDTO" resultType="patientDTO">
  	select * from dl_user where p_name = '환자1' 
  </select>
  
   <!-- 김다유 : 처방전 의사 정보 -->
  <select id="doctor_info" parameterType="String" resultMap="doctorMap">
  	SELECT * FROM dl_doctor a JOIN department b ON a.dep_num = b.dep_num where d_name=#{d_name}
  </select>
  
   <!-- 김다유 : 처방전 병원 정보 -->
  <select id="drLink_info" resultType="drLinkDTO">
  	select * from drlink 
  </select>
  
  <!-- 김다유 : 약품정보 -->
  <select id="medicine_info" resultType="medicineDTO">
  	select * from medicine
  </select>
  
  <!-- 김다유 : 처방전 상세 정보 -->
  <!-- 테스트 중이라 향후에 patient_num=#{patient_num}으로 수정해야함  -->
  <select id="detail_prescription" parameterType="int" resultType="prescriptionDTO">
	select * 
	from 
		prescription p, treatment_record t, dl_user u, dl_doctor d, medicine m 
	where 
		p.patient_num=44 
	and p.patient_num=u.patient_num 
	and p.doctor_num = d.doctor_num 
	and p.medicine_num = m.medicine_num 
	and p.treatment_num=t.treatment_num;
  </select>
  
  </mapper>